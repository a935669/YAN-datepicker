<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="jquery-ui.css">
</head>

<body>
    <input type="text">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
        $(function() {
            var invalid = {
                "single": ["2012/2/4", "2012/3/2"],
                "recurrent_day": [0],
                "recurrent_date": [27],
                "period": [{
                    "from": "2012/2/21",
                    "to": "2012/2/22"
                }],
                "recurrent_period": [{
                    "from": "2012/2/28",
                    "to": "2012/2/29",
                    "period": "monthly"
                }, {
                    "from": "2012/2/7",
                    "to": "2012/2/9",
                    "period": "yearly"
                }]
            };

            // 檢查陣列是否有值
            function single(date) {
                var USdate = date.getFullYear() + "/" + (date.getMonth() + 1) + "/" + date.getDate();
                // console.log(USdate)
                return ($.inArray(USdate, invalid.single) > -1);
            }

            function recurrent_day(date) {
                return ($.inArray(date.getDay(), invalid.recurrent_day) > -1);
            }

            function recurrent_date(date) {
                return ($.inArray(date.getDate(), invalid.recurrent_date) > -1);
            }

            function period(date) {
                var i, num, period, start, startArray, end, endArray;
                num = invalid.period.length;
                // console.log(num)
                for (i = 0; i < num; i++) {
                    period = invalid.period[i];
                    // console.log(period)
                    startArray = period.from.split('/');
                    // console.log(startArray)
                    start = new Date(startArray[2], (startArray[0] - 1), startArray[1]);
                    // console.log(start)
                    endArray = period.to.split('/');
                    // console.log(endArray)
                    end = new Date(endArray[2], (endArray[0] - 1), endArray[1]);
                    // console.log(end)
                    if (date >= start && date <= end) {
                        return true;
                    }
                }
                return false;
            }

            function recurrent_period(date) {
                var i, num, period, recurrence, startArray, endArray, startDay, endDay, start, end;
                num = invalid.recurrent_period.length;
                for (i = 0; i < num; i++) {
                    period = invalid.recurrent_period[i];
                    // console.log(period)
                    recurrence = period.period;
                    // console.log(recurrence)
                    startArray = period.from.split('/');
                    // console.log(startArray)
                    endArray = period.to.split('/');
                    // console.log(endArray)

                    if (recurrence === 'monthly') {
                        startDay = parseInt(startArray[1], 10);
                        // console.log(startDay)
                        endDay = parseInt(endArray[1], 10);
                        // console.log(endDay)
                        if (date.getDate() >= startDay && date.getDate() <= endDay) {
                            return true;
                        }
                    } else if (recurrence === 'yearly') {
                        start = new Date(date.getFullYear(), (startArray[0] - 1), startArray[1]);
                        end = new Date(date.getFullYear(), (endArray[0] - 1), endArray[1]);
                        console.log({
                            start: start.toDateString(),
                            end: end.toDateString(),
                            day: date.toDateString()
                        })
                        if (date >= start && date <= end) {
                            return true;
                        }
                    }
                }
                return false;
            }

            $('input').datepicker({
                changeMonth: true,
                changeYear: true,
                "dateFormat": "yy/mm/dd",
                beforeShowDay: function(date) {
                    // console.log(date)
                    if (single(date)) {
                        // console.log(date)
                        return [false];
                    } else if (recurrent_day(date)) {
                        // console.log(date)
                        return [false];
                    } else if (recurrent_date(date)) {
                        return [false];
                    } else if (period(date)) {
                        return [false];
                    } else if (recurrent_period(date)) {
                        return [false];
                    }
                    return [true];
                }
            });


        });
    </script>
</body>

</html>